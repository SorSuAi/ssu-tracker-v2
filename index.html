<!DOCTYPE html>
<html>
<head>
    <title>SSU Tracker</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style>
        body { font-family: sans-serif; text-align: center; padding: 20px; }
        button { padding: 20px; margin: 10px; width: 80%; font-size: 1.2em; cursor: pointer; }
        .active { background-color: #4CAF50; color: white; }
    </style>
    <link rel="manifest" href="manifest.json">
    <script>
    if ('serviceWorker' in navigator) {
        navigator.serviceWorker.register('sw.js');
    }
    </script>
</head>
<body>
    <h2>SSU Attendance & Recitation</h2>
    <p id="status">Tap a mode to start scanning...</p>
    
    <button id="btnAttendance" onclick="setMode('Attendance')">Mode: Attendance</button>
    <button id="btnRecitation" onclick="setMode('Recitation')">Mode: Recitation</button>

   <script>
    let currentMode = "Attendance";
    // Your Script URL is now integrated
    const scriptURL = "https://script.google.com/macros/s/AKfycbx5sZG0zIJhkB8P6LjKolCrwXXuDzfsrYWU8enK4Ln_cZS9UwcBX__PHLixbYCjnoKJ/exechttps://script.google.com/macros/s/AKfycbx5sZG0zIJhkB8P6LjKolCrwXXuDzfsrYWU8enK4Ln_cZS9UwcBX__PHLixbYCjnoKJ/exec";

    // Function to create a "Beep" sound using Web Audio API
    function playBeep(frequency = 880, duration = 150) {
        const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        const oscillator = audioCtx.createOscillator();
        const gainNode = audioCtx.createGain();

        oscillator.type = 'sine';
        oscillator.frequency.setValueAtTime(frequency, audioCtx.currentTime);
        oscillator.connect(gainNode);
        gainNode.connect(audioCtx.destination);

        gainNode.gain.setValueAtTime(0.1, audioCtx.currentTime); // Volume
        oscillator.start();
        oscillator.stop(audioCtx.currentTime + (duration / 1000));
    }

    function setMode(mode) {
        currentMode = mode;
        document.getElementById('status').innerText = "Mode: " + mode;
        playBeep(440, 50); // Low short beep for mode change
    }

    async function startScanning() {
        if ('NDEFReader' in window) {
            try {
                const ndef = new NDEFReader();
                await ndef.scan();
                document.getElementById('status').innerText = "ðŸ“¡ Scanner Active...";

                ndef.onreading = event => {
                    const id = event.serialNumber;
                    logToSheet(id);
                };
            } catch (error) {
                document.getElementById('status').innerText = "Error: " + error;
            }
        }
    }

    function logToSheet(id) {
        fetch(`${scriptURL}?id=${id}&type=${currentMode}`)
            .then(() => {
                document.getElementById('status').innerHTML = 
                    `<b style="color: green;">Success!</b><br>ID: ${id}`;
                
                // Sound and Vibration confirmation
                playBeep(880, 200); // High beep for success
                if (navigator.vibrate) navigator.vibrate([100, 50, 100]); 
            })
            .catch(err => {
                playBeep(220, 500); // Low "error" buzz
                console.error(err);
            });
    }

    // Initialize on first interaction
    document.body.addEventListener('click', () => {
        startScanning();
    }, { once: true });
</script>
</body>
</html>